<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Calcul Bague/Fraise</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background: #f5f5f5;
}

/* Titre */
h2 {
  text-align: center;
  background: #007bff;
  color: white;
  padding: 12px 0;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* Onglets */
.tabs {
  display: flex;
  margin: 20px 0;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.tab-button {
  flex: 1;
  padding: 14px;
  cursor: pointer;
  border: none;
  font-weight: bold;
  background: #e0e0e0;
  transition: 0.3s;
  font-size: 16px;
}
.tab-button.active {
  background: #007bff;
  color: white;
}

/* Contenu onglet */
.tab-content {
  display: none;
  background: transparent;
  padding: 0;
  margin-top: 0;
}
.tab-content.active {
  display: block;
}

/* Boutons g√©n√©raux */
button {
  padding: 12px 20px;
  margin: 8px;
  cursor: pointer;
  font-size: 16px;
  border-radius: 6px;
  border: none;
  background: #007bff;
  color: white;
  transition: 0.2s;
}
button:hover {
  background: #0056b3;
}

/* Table style "Filetage" */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin-bottom: 20px;
  font-size: 16px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  border-radius: 12px;
  overflow: hidden;
}

/* En-t√™tes */
th {
  background: #007bff;
  color: white;
  font-weight: bold;
  padding: 12px;
  text-align: center;
}

/* Cellules */
td {
  background: #f9f9f9;
  text-align: center;
  padding: 10px 12px;
  vertical-align: middle;
  word-break: break-word;
}

/* Alternance de couleur des lignes */
tbody tr:nth-child(odd) td {
  background: #f0f4f8;
}
tbody tr:nth-child(even) td {
  background: #ffffff;
}

/* Cellules contenteditable */
td[contenteditable] {
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 8px 12px;
  min-width: 50px;
  line-height: 1.4em;
  vertical-align: middle;
}

/* Spans pour couple / fraise / d√©calage */
.couple-cell, .fraise-cell, .decalage-cell {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 6px;
  font-weight: bold;
  margin: 2px 2px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.fraise-cell { background: #d0e8ff; color: #000; }
.couple-cell { background: #b8f5d4; color: #000; }
.decalage-cell { background: #fff3cd; color: #000; }

/* Responsive */
@media(max-width:600px) {
  table {
    display: block;
    overflow-x: auto;
  }
  th, td {
    white-space: nowrap;
  }
}
</style>
</head>
<body>

<h2>‚öôÔ∏è Calcul des couples bague/fraise</h2>

<div class="tabs">
  <button class="tab-button active" onclick="openTab('tab1', this)">2 Bagues 1 Fraise</button>
  <button class="tab-button" onclick="openTab('tab2', this)">2 Bagues 2 Fraises</button>
  <button class="tab-button" onclick="openTab('tab3', this)">Bagues & Fraises</button>
</div>

<div id="tab1" class="tab-content active">
  <button onclick="calculer('principal')">üìä Calculer</button>
  <table>
    <thead>
      <tr>
        <th>√ò Fraise</th>
        <th>Couples (fraise / bague)</th>
        <th>D√©calage</th>
      </tr>
    </thead>
    <tbody id="resultatsPrincipal"></tbody>
  </table>
</div>

<div id="tab2" class="tab-content">
  <button onclick="calculer('inclusion')">üìä Calculer</button>
  <table>
    <thead>
      <tr>
        <th>Couples (fraise / bague)</th>
        <th>D√©calage</th>
      </tr>
    </thead>
    <tbody id="resultatsInclusion"></tbody>
  </table>
</div>

<div id="tab3" class="tab-content">
  <button onclick="calculer('all')">üìä Calculer tous</button>

  <h3>Bagues disponibles</h3>
  <table id="tableBagues">
    <thead>
      <tr>
        <th>√ò Ext√©rieur</th>
        <th>√ò Int√©rieur (limite fraise)</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="ajouterLigne('tableBagues')">‚ûï Ajouter une bague</button>
  <button onclick="resetTable('tableBagues')">üóëÔ∏è Vider toutes les bagues</button>

  <h3>Fraises disponibles</h3>
  <table id="tableFraises">
    <thead>
      <tr>
        <th>√ò Fraise</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="ajouterLigne('tableFraises')">‚ûï Ajouter une fraise</button>
  <button onclick="resetTable('tableFraises')">üóëÔ∏è Vider toutes les fraises</button>
</div>

<script>
// Gestion onglets
function openTab(tabId, btn) {
  document.querySelectorAll(".tab-content").forEach(el => el.classList.remove("active"));
  document.getElementById(tabId).classList.add("active");
  document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
}

// Ajouter / supprimer / reset lignes
function ajouterLigne(tableId, values = []) {
  const table = document.getElementById(tableId).getElementsByTagName('tbody')[0];
  const newRow = table.insertRow();
  if (tableId === 'tableBagues') {
    newRow.innerHTML = `<td contenteditable="true">${values[0] || ""}</td>
                        <td contenteditable="true">${values[1] || ""}</td>
                        <td><button onclick="supprimerLigne(this)">‚ùå</button></td>`;
  } else {
    newRow.innerHTML = `<td contenteditable="true">${values[0] || ""}</td>
                        <td><button onclick="supprimerLigne(this)">‚ùå</button></td>`;
  }
  newRow.querySelectorAll('td[contenteditable]').forEach(td => {
    td.addEventListener('input', sauvegarder);
    td.addEventListener('blur', sauvegarder);
  });
  sauvegarder();
}
function supprimerLigne(btn) { btn.parentNode.parentNode.remove(); sauvegarder(); }
function resetTable(tableId) { document.getElementById(tableId).getElementsByTagName('tbody')[0].innerHTML = ""; sauvegarder(); }

// Lecture des tables
function lireTableBagues() {
  return Array.from(document.querySelectorAll("#tableBagues tbody tr"))
    .map(r => { const ext = parseFloat(r.cells[0].innerText), int = parseFloat(r.cells[1].innerText); return { ext, int }; })
    .filter(b => !isNaN(b.ext) && !isNaN(b.int));
}
function lireTableFraises() {
  return Array.from(document.querySelectorAll("#tableFraises tbody tr"))
    .map(r => { const d = parseFloat(r.cells[0].innerText); return { d }; })
    .filter(f => !isNaN(f.d));
}

// Sauvegarde / chargement localStorage
function sauvegarder() {
  const bagues = [], fraises = [];
  document.querySelectorAll("#tableBagues tbody tr").forEach(r => bagues.push([r.cells[0].innerText, r.cells[1].innerText]));
  document.querySelectorAll("#tableFraises tbody tr").forEach(r => fraises.push([r.cells[0].innerText]));
  localStorage.setItem("bagues", JSON.stringify(bagues));
  localStorage.setItem("fraises", JSON.stringify(fraises));
}

function charger() {
  let bagues = JSON.parse(localStorage.getItem("bagues") || "[]");
  let fraises = JSON.parse(localStorage.getItem("fraises") || "[]");
  if (bagues.length === 0) bagues = [[10,8],[12,10],[14,12],[16,14],[18,16], [20,18],[24,22],[30,28],[40,28],[60,28]];
  if (fraises.length === 0) fraises = [[8],[10],[12],[14],[16],[19]];

  bagues.forEach(b => ajouterLigne('tableBagues', b));
  fraises.forEach(f => ajouterLigne('tableFraises', f));

  const resP = localStorage.getItem("resultatsPrincipal");
  if(resP) document.getElementById("resultatsPrincipal").innerHTML = resP;
  const resI = localStorage.getItem("resultatsInclusion");
  if(resI) document.getElementById("resultatsInclusion").innerHTML = resI;
}

// Calculs
function calculer(mode="all") {
  const bagues = lireTableBagues(), fraises = lireTableFraises(), tol=0.01;

  if(mode==="principal" || mode==="all") {
    let html1="";
    fraises.forEach(f=>{
      for(let i=0;i<bagues.length;i++){
        for(let j=i+1;j<bagues.length;j++){
          let [bSmall,bLarge,intSmall,intLarge]=bagues[i].ext<=bagues[j].ext?[bagues[i].ext,bagues[j].ext,bagues[i].int,bagues[j].int]:[bagues[j].ext,bagues[i].ext,bagues[j].int,bagues[i].int];
          if(f.d<=intSmall && f.d<=intLarge){
            const delta=(bSmall+f.d)/2;
            if(Math.abs(delta-(bLarge-f.d)/2)<tol){
              html1+=`<tr><td><span class="fraise-cell">F${f.d}</span></td>
                        <td><span class="couple-cell">B${bSmall} / B${bLarge}</span></td>
                        <td><span class="decalage-cell">${delta.toFixed(2)}</span></td></tr>`;
            }
          }
        }
      }
    });
    document.getElementById("resultatsPrincipal").innerHTML=html1;
    localStorage.setItem("resultatsPrincipal",html1);
  }

  if(mode==="inclusion"||mode==="all"){
    let html2="";
    const seen=new Set();
    for(let i=0;i<bagues.length;i++){
      for(let j=i+1;j<bagues.length;j++){
        let [bSmall,bLarge,intSmall,intLarge]=bagues[i].ext<=bagues[j].ext?[bagues[i].ext,bagues[j].ext,bagues[i].int,bagues[j].int]:[bagues[j].ext,bagues[i].ext,bagues[j].int,bagues[i].int];
        fraises.forEach(f1=>{
          fraises.forEach(f2=>{
            if(f1.d===f2.d) return;
            if(f1.d<=intSmall && f2.d<=intLarge){
              const delta=(bSmall+f1.d)/2;
              if(Math.abs(delta-(bLarge-f2.d)/2)<tol){
                const key=`${bSmall}_${bLarge}_${f1.d}_${f2.d}`;
                if(!seen.has(key)){
                  seen.add(key);
                  html2+=`<tr><td>
                            <span class="couple-cell">F${f1.d} / B${bSmall}</span>
                            <span class="couple-cell">F${f2.d} / B${bLarge}</span>
                            </td>
                            <td><span class="decalage-cell">${delta.toFixed(2)}</span></td></tr>`;
                }
              }
            }
          });
        });
      }
    }
    document.getElementById("resultatsInclusion").innerHTML=html2;
    localStorage.setItem("resultatsInclusion",html2);
  }
}

window.onload=charger;
</script>

</body>
</html>
